{% extends "base.html" %}
{% load widgets %}

{% block head %}
    <script src="{{ STATIC_URL }}js/handlers.js"></script>
    <script src="{{ STATIC_URL }}js/csrf.js"></script>
    <script src="{{ STATIC_URL }}js/vote.js"></script>

    <!-- prettify -->
    <link href="{{ STATIC_URL }}lib/prettify.css" rel="stylesheet"> 
    <script src="{{ STATIC_URL }}lib/prettify.js"></script>

{% endblock %}

{% block document_ready %}
    
    $(".alert").alert()
    
    // google prettify library
    $('pre').addClass('prettyprint')
    prettyPrint()

    // moderation handlers defined in /static/js/mod.js
    // close/reopen delete/destroy handler
    $('.mod-link').click(function(){
        mod_link_clicked($(this))
    });
    
    $('.comment-delete').click(function(){
        comment_delete($(this))
    });
    
    // register the add comment function
    $('.add-comment').each(function(){
        elem = $(this)
        //console.log(elem)
        //callback function defined in /static/js/widgets.js
        elem.click(function(){
            show_add_comment($(this).parent(), $(this).parent().children('input').val()); 
        });
    });
    
    // register the voting function
    $('.vote').each(function(){
        elem = $(this)
        
        // register a handler for each votable element
        //callback functions defined in /static/js/vote.js
        up_button  = elem.children('.vote-up')
        
        up_button.click(function(){
            do_vote($(this), $(this).parent().children('input').val(), 'upvote'); 
        });
        
        bookmark_button = elem.children('.vote-bookmark')
        bookmark_button.click(function(){
            do_vote($(this), $(this).parent().children('input').val(), 'bookmark'); 
        });
        
        accept_button = elem.children('.vote-accepted')
        accept_button.click(function(){
            do_vote($(this), $(this).parent().children('input').val(), 'accept'); 
        });
    });
    
{% endblock %}

{% block body %}
    
    {# renders the main post #}
    <div class="row">{% render_post root tree %}</div>
 
    <div class="row separator">&nbsp;</div>
    
    {# renders all the followups post #}
    {% for answer in answers %}
        <div class="row">{% render_post answer tree %}</div>
        <div class="row separator">&nbsp;</div>
    {% endfor %}
            
{% endblock %}
