{% extends "forum_list.html" %}
{% load forum_tags %}

{% block headtitle %}
    {{ post.title }}
{% endblock %}


{% block body %}


    {# The toplevel post #}
    <div class="ui vertical segment">
        {% post_body post=post user=request.user tree=tree %}
    </div>

    {# Render each answer for the post #}
    {% for answer in answers %}
        <div class="ui vertical segment">
            {% post_body post=answer user=request.user tree=tree %}
        </div>
    {% endfor %}


    {% if request.user.is_authenticated and post.is_open %}

        <div class="ui info tablet message">
                Use the <span class="ui tiny label">ADD COMMENT</span> or <span
                        class="ui tiny label">ADD REPLY</span> buttons
                embedded in each post to comment, to ask for clarifications, to request more details, or respond
                to a
                previous answer or comment.
            </p>
        </div>
        <div>
        <div class="ui small header">Add your answer</div>

            <form method="post" class="ui  form" action="{% url 'post_view' post.uid %}">

                {{ form.media }}
                {% csrf_token %}
            <input type="hidden" name="parent_uid" id="parent_uid" value="{{ post.uid }}">
            <div ondragover="allowDrop(event);" ondrop="drop(event, '{{ post.uid }}')">
                <div class="ui form-wrap segment droptarget" data-value="{{ post.uid }}" data-thread="{{ post|get_children_list }}"
                     ondragover="drag_over(event, '{{ post.uid }}')" ondragleave="drag_leave(event, '{{ post.uid }}')">
                    <div class="required input field">
                        {% include 'widgets/posting_msg.html' %}

                        <div class="wmd-wrapper" id="wmd-wrapper-{{ form.content.id_for_label }}">
                            <div class="">
                                <div id="wmd-button-bar-{{ form.content.id_for_label }}"></div>
                                <textarea class="wmd-input" cols="40" name="content" rows="10"
                                          id="wmd-input-{{ form.content.id_for_label }}"></textarea>
                            </div>

                        </div>
                    </div>

                </div>
            </div>

                <div class="ui preview segment">
                    <div class="field">
                        <label>Preview</label>
                        <div id="wmd-preview-{{ form.content.id_for_label }}" class="wmd-preview"></div>
                    </div>
                </div>
{#                <div class="ui form-wrap segment">#}
{#                    <div class="field">#}
{#                        <label>Preview</label>#}
{#                        <div id="{{ form.content.id_for_label }}_wmd-preview" class="wmd-preview"></div>#}
{#                    </div>#}
{#                </div>#}
                {% if form.captcha %}
                    <div class="top-padding">
                        <div class="required field">
                            {{ form.captcha }}
                        </div>
                    </div>
                {% endif %}

                <div class="top-padding">
                    <button type="submit" class="ui submit green button">
                        <i class="check icon"></i>Submit
                    </button>
                </div>
            </form>

        </div>

    {% elif not post.is_open %}
        <div class="ui warning message">
            This thread is not open. No new answers may be added
        </div>
    {% else %}
        <div class="ui info message">
            <p><a class="ui small label" href="{% url 'login' %}">
                <i class="sign in icon"></i>Login</a> before adding your answer.</p>
        </div>

    {% endif %}

{% endblock %}

{% block sidebar %}

    <div id="similar-feed" post_uid="{{ post.uid }}"></div>

{% endblock %}
