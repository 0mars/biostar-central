{% load forum_tags %}

    {% if post.is_toplevel %}

    <div class="ui vertical segment">
        {% subs_actions post=post user=request.user next=next_url sub_url=sub_url %}
        <div class="ui header" >{{ post.get_type_display }}: {{ post.get_title }}</div>

    </div>

    {% endif %}

    <div class="ui items {{post.deleted_class}} {{post.accepted_class}}">
        <div class="item">
            <div class="ui image">


                <a class="vote" data-post_uid="{{post.uid}}" data-type="upvote" vote-url="{% url 'vote' %}">
                    {% if post.has_upvote %}
                        <i class="large thumbs up icon"></i>
                    {% else %}
                        <i class="large thumbs up outline icon"></i>
                    {% endif %}

                </a>

                <div class="ui center aligned count header">{{ post.vote_count }}</div>

                <a class="vote" data-post_uid="{{post.uid}}" data-type="bookmark" vote-url="{% url 'vote' %}">
                    {% if post.has_bookmark %}
                        <i class="large bookmark icon"></i>
                    {% else %}
                        <i class="large bookmark outline icon"></i>
                    {% endif %}

                </a>

                <div></div>

                {% if user == post.root.author and not post.is_toplevel %}

                    <a class="vote" data-post_uid="{{post.uid}}" data-type="accept" vote-url="{% url 'vote' %}">
                        {% if not post.has_accepted %}<i class="large check circle green outline icon"></i>
                        {% else %}<i class="large check circle green icon"></i>{% endif %}
                    </a>
                {% elif post.has_accepted and not post.is_toplevel %}
                    <i class="large check circle green icon"></i>
                {% endif %}

            </div>

             <div class="content">

             {% if include_userbox %}
                 <div class="ui right floated image" >
                        {% user_box user=post.author %}
                 </div>
             {% endif %}

                 <div class="ui container">

                        {{ post.html|safe }}
                     </div>

                 {% if post.is_toplevel %}
                     <div class="extra">

                         <div class="" style="">


                    {% get_tags_list post.tag_val as tags_list %}

                    {% for tag in tags_list %}
                        <a class="ui tiny tagging label" href="{% url 'post_list' %}?topic={{tag}}">
                        {{ tag }}
                        </a>
                    {% endfor %}
                            &bull; {{ post.root.view_count|bignum }} views
                         </div>

                     </div>

                     <div class="ui right floated basic segment userinfo">

                         {% user_info post=post by_diff=False %}
                     </div>

                 {% else %}


                     <div class="extra"></div>
                        <div class="ui right floated basic segment userinfo">
                             {% user_info post=post by_diff=False %}
                         </div>

                 {% endif %}
                 <div class="extrainfo">

             {% if user.is_authenticated %}
            <a class="add-comment ui mini grey label" comment-url="{% url 'post_comment' %}"
               data-value="{{post.uid}}" project-uid="{{project_uid}}" redir-url="{{next_url}}">
                ADD COMMENT
            </a>
             {% else %}
             <a class="ui mini grey label" href="{% url 'login' %}">
                ADD COMMENT
            </a>

             {% endif %}

                 <a href="#">link</a>

                  {% if post.is_editable %}
                 |
                 <a href="{% url 'post_edit' post.uid %}">
                edit
                </a>
                 {% endif %}

                 {% if user.is_authenticated and user.profile.is_moderator or user.profile.is_manager %}
                 |
                 <a class="moderate-post" mod-url="{% url 'post_moderate' post.uid %}" data-value="{{post.uid}}">
                moderate
                </a>
                 <div id="mod-container-{{post.uid}}"></div>
                 {% endif %}


                <div id="comment-container-{{post.uid}}"></div>
                 {# Comments for each post rendered here #}

                {% render_comments tree=tree project_uid=project_uid request=request post=post next_url=next_url %}

                 </div>
             </div>

        </div>


    </div>




