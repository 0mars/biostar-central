{% load staticfiles %}
{% load forum_tags %}

<div class="ui inplace inputcolor basic segment" style="padding-bottom: 5px; border-radius: 6px;">

    <form class="ui inplace create-form compact form" id="create">
        <div style="display:-webkit-box;">
            <div class="three wide field" style="width: 20%; padding-right: 5px">
                <b>Type</b>
                {% inplace_type_field field_id='new-type' %}
            </div>
            <div class="field" style="width: 80%;">
                <b>Title</b>
                <textarea id="new-title" rows="1" style="padding: .69em;"></textarea>
            </div>
        </div>

        <div class="field">
            <b>Content</b>
            <textarea id="new-content" rows="10"></textarea>
        </div>

        <div class="field">
            {% get_tags post=post as tags %}

            <input type="hidden" name="tag_val" id="new-tag_val_id" value="{{ tags.selected }}" placeholder="Tags">
            <b>Tags</b>
            <select multiple="multiple" class="ui search selection dropdown tag-field" id="new-tags"
                    field_id="new-tag_val_id">

                {% for value, selected_tag in tags.tags_opt %}
                    {% if selected_tag %}
                        <option value="{{ value }}" selected="selected">{{ value }}</option>
                    {% else %}
                        <option value="{{ value }}">{{ value }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>

        <div class="field">

            <a class="ui green label save"><i class="check icon"></i>Save</a>
            <a class="ui label create-preview">
                <i class="eye icon"></i> Preview
            </a>
            <a class="ui label cancel"><i class="undo icon"></i> Cancel</a>

        </div>

        <p class="muted"
           style="font-size: smaller;">Tips: CTRL+ENTER to submit the form. ESC to
            cancel. Double-click to edit post. Markdown accepted.
        </p>
        <div class="preview">
            <div class="ui preview segment">
                <div id="html-preview"></div>
            </div>
        </div>

    </form>

</div>

<script>
    $('.ui.dropdown').dropdown();
    $('.tag-field').dropdown({
        allowAdditions: true,
        onChange: function (value, text, $selectedItem) {
            // Get form field to add to
            var tagid = $("#new-tags").attr('field_id');
            var tag_field = $('#{0}'.f(tagid));
            // Add selected tag to field
            //alert(value);
            tag_field.val(value);
        }
    });

    $('.tag-field >input.search').keydown(function (event) {
        // Prevent submitting form when adding tag by pressing ENTER.
        if (event.keyCode === 13) {
            event.preventDefault();
        }
        // Set value with SPACE bar
        if (event.keyCode === 32) {
            event.preventDefault();
            $("#new-tags").dropdown('set selected', $(this).val().trim());
            $(this).val('')
        }

    });
</script>
