{% load forum_tags %}

{% if post.is_toplevel %}
    <h3 id="post-title">{{ post.get_type_display }}: {{ post.title }}</h3>
{% endif %}


<div class="ui items {{post.deleted_class}} {{post.accepted_class}}">

    <div class="item">
        <a name="{{post.uid}}"></a>
        <div id="vote-menu" class="ui tiny vertical secondary menu">
            <a class="item vote" data-post_uid="{{post.uid}}" data-type="upvote" vote-url="{% url 'vote' %}">
                {% if post.has_upvote %}
                    <i class="thumbs up icon"></i>
                {% else %}
                    <i class="thumbs up outline icon"></i>
                {% endif %}
            </a>

            <div class="item count">{{ post.vote_count }}</div>

            <a class="item vote" data-post_uid="{{post.uid}}" data-type="bookmark" vote-url="{% url 'vote' %}">
                {% if post.has_bookmark %}
                    <i class="bookmark icon"></i>
                {% else %}
                    <i class="bookmark outline icon"></i>
                {% endif %}

            </a>

            {% if user == post.root.author and not post.is_toplevel %}
                <a class="item vote" data-post_uid="{{post.uid}}" data-type="accept" vote-url="{% url 'vote' %}">
                    {% if not post.has_accepted %}<i class="check circle green outline icon"></i>
                    {% else %}<i class="check circle green icon"></i>{% endif %}
                </a>
            {% elif post.has_accepted and not post.is_toplevel %}
                <i class="check circle green icon"></i>
            {% endif %}

        </div>

         <div class="ui container postbody">
                 <div class="ui right floated image" >
                        {% user_box user=post.author %}
                 </div>

                {{ post.html|safe }}

                {% if post.is_toplevel %}
                        {% get_tags_list post.tag_val as tags_list %}
                        {% for tag in tags_list %}
                            <a class="ui tiny tagging label" href="{% url 'post_list' %}?tag={{tag}}">
                            {{ tag }}
                            </a>
                        {% endfor %}
                        <span class="muted smaller-font">
                            &bull; {{ post.root.view_count|bignum }} views
                        </span>
                {% endif %}


              <div class="padding-top smaller-font">

                    {% if user.is_authenticated %}
                        <a class="add-comment ui mini basic label smaller-font" comment-url="{% url 'comment_form' post.uid %}"
                           data-value="{{post.uid}}">
                            ADD COMMENT
                        </a>
                    {% else %}
                         <a class="ui mini label" href="{% url 'login' %}">
                            ADD COMMENT
                        </a>
                    {% endif %}
                    &bull; <a href="{% url 'post_view' post.root.uid %}#{{post.uid}}">link</a>

                    {% if  user.is_authenticated %}
                         {% if user == post.author or user.profile.is_moderator %}
                         &bull; <a href="{% url 'post_edit' post.uid %}">edit</a>{% endif %}
                    {% endif %}

                    <div class="ui muted" style="float: right">
                        updated
                        <span>{{ post.lastedit_date|time_ago }}</span> by
                        <a href="{% url "user_profile"  post.lastedit_user.profile.uid %}">

                        {{post.lastedit_user.profile.name }}

                        </a>
                        {{ post.lastedit_user |show_score_icon }}
                        {{ post.lastedit_user.profile.score | show_score | bignum }}

                    </div>

                    {% if user.is_authenticated and user.profile.is_moderator %}
                        &bull;<a class="moderate-post" mod-url="{% url 'post_moderate' post.uid %}" data-value="{{post.uid}}">
                        moderate</a>
                        <div id="mod-container-{{post.uid}}"></div>
                    {% endif %}

                    <div id="comment-container-{{post.uid}}"></div>
                    {# Comments for each post rendered here #}
                    {% render_comments tree=tree post=post %}

              </div>

         </div>


    </div>

</div>