{% extends "profile_base.html" %}

{% load engine_tags %}
{% load forum_tags %}


{% block headtitle %}{{ user.profile.name }}{% endblock %}

{% block body %}


<div class="ui center aligned header"> {{ user.profile.get_role_display }}: {{ user.profile.name }}</div>

<div class="ui relaxed grid">

<div class="row">
    <div class="four wide column">
        <div class="ui center aligned basic large segment">
          <div class="ui circular image">
            <a href="{% url "public_profile" user.profile.uid %}">{% gravatar user=user size=200 %}</a>

            </div>
            <div>
        {{user.profile.name}} {{ user.profile.score |show_score_icon}}  {{ user.profile.score | show_score |bignum }}
            </div>
        </div>

    </div>

    <div class="seven wide column">


        <div class="ui left aligned basic large segment">

            <div>
            <b>Reputation</b> : {{ user.profile.score | show_score }}
            </div>
            <div>
            <b>Status</b> : {{ user.profile.get_state_display }}
            </div>
            <div>
            <b>Location</b> : {{ user.profile.location }}
            </div>

            {% if user.profile.last_login  %}
                <div>
                <b>Last seen </b> : {{ user.profile.last_login |time_ago}}
                </div>
            {%  endif %}

            <div>
                <b>Joined</b> : {{ user.profile.date_joined|time_ago }}

            </div>
            <div> <b>Email</b> : {{ user |show_email }}
            </div>

        </div>

        {%  if user == request.user %}

             <div class="ui center aligned basic vertical segment">

                 <a class="ui mini button" href="{% url 'edit_profile'%}">
                        <i class="write icon"></i>Edit profile
                    </a>


                <a class="ui mini button" href="{% url 'recycle_bin' %}">
                    <i class="trash icon"></i>Recycle Bin
                </a>

                {% if user.profile.notify %}
                    <a class="ui mini red button" href="{% url 'toggle_notify' %}">
                        <i class="mail icon"></i>Disable Emails
                    </a>
                    {% if user.is_superuser %}
                        <a class="ui mini blue button" href="{% url 'site_admin' %}">
                            <i class="dashboard icon"></i> Site Admin
                        </a>
                    {% endif %}

                 <div class="ui vertical basic segment">
                    Email notifications are <b>enabled</b>. You will receive an email every time your recipe has finished running.
                  </div>

                    {% else %}
                    <a class="ui mini green button" href="{% url 'toggle_notify' %}">
                        <i class="mail icon"></i>Enable Emails
                    </a>

                    {% if user.is_superuser %}
                        <a class="ui mini blue button" href="{% url 'site_admin' %}">
                            <i class="dashboard icon"></i> Site Admin
                        </a>
                    {% endif %}
                {% endif %}


            </div>

        {% endif %}
    </div>

    <div class="five wide column">


        {{ user.profile.html |safe }}


    </div>
</div>

    <div class="row">

        <div class="sixteen wide column">
             <div class="ui vertical segment">
        <div class="ui top attached tabular large menu">

            <div class="{{ has_posts }} item">
                <a href="{% url "public_profile" user.profile.uid %}?{{ const_name }}={{ const_post }}">
                    Posts
                </a>

            </div>

            <div class="{{ has_projects }} item">

            <a href="{% url "public_profile" user.profile.uid %}?{{ const_name }}={{ const_project }}">
               Projects
            </a>

            </div>

            {% if user.profile.is_manager and user == request.user %}
                <div class="{{ has_recipes }} item">

                    <a href="{% url "public_profile" user.profile.uid %}?{{ const_name }}={{ const_recipes }}">
                       Recipes to Manage
                    </a>

                </div>

            {%  endif %}

        </div>
<div class="ui bottom attached segment">
        {% if has_posts %}


            {% get_posts user=user request=request as posts %}
            {% pages objs=posts request=request  %}

            <div class="ui small relaxed divided list">
                {% listing posts=posts %}
            </div>
            {% if not posts %}
            <div class="ui warning message"><i class="ui warning circle icon"></i> No posts found.</div>
            {% endif %}
            {% pages objs=posts request=request %}


        {% elif has_projects %}

            {% get_projects user=user request=request as projects %}

            {% pages objs=projects request=request %}
            {% list_view projects=projects %}

            {% if not projects %}
            <div class="ui warning message"><i class="ui warning circle icon"></i> No projects found.</div>
            {% endif %}
            {% pages objs=projects request=request %}


        {% elif has_recipes and user.profile.is_manager and user == request.user %}

             <div class="ui basic segment">
                {% recipes_moderate %}
            </div>
        {% endif %}
</div>
        </div>
        </div>

    </div>

</div>



{%  endblock %}