{% extends "forum_base.html" %}
{% load message_tags %}
{% load forum_tags %}


{% block headtitle %}
    Messages
{% endblock %}



{% block grid %}
{% with params=request.GET.urlencode %}
     <div class="pages-banner">

            <div class="ui small compact menu no-shadow" style="float: left">
              <div class="ui simple dropdown item">

                <i class="{% get_icon string=limit default='all' %}"></i>
                <span class="tablet">{% get_wording prefix="Limit to:" filtered=limit default="all" %}</span>
                <i class="dropdown icon"></i>

                <div class="menu">
                      <a class="item" href="{% url "inbox" %}{% relative_url 'all' 'limit' params %}">
                          <i class="{% get_icon 'all' %}"></i>all time
                      </a>
                      <a class="item" href="{% url "inbox" %}{% relative_url 'today' 'limit' params %}">
                          <i class="{% get_icon 'today' %}"></i>today
                      </a>
                      <a class="item" href="{% url "inbox" %}{% relative_url 'week' 'limit' params %}">
                          <i class="{% get_icon 'week' %}"></i>this week
                      </a>
                      <a class="item" href="{% url "inbox" %}{% relative_url 'month' 'limit' params %}">
                          <i class="{% get_icon 'month' %}"></i>this month
                      </a>
                      <a class="item" href="{% url "inbox" %}{% relative_url 'year' 'limit' params %}">
                          <i class="{% get_icon 'year' %}"></i>this year
                      </a>
                </div>
              </div>
            </div>
                {% pages objs=all_messages request=request %}

            <div class="ui small compact menu ordering no-shadow">
              <div class="ui simple dropdown item">

                <i class="{% get_icon string=order default='sent' %}"></i>
                <span class="tablet">{% get_wording prefix="Sort :" filtered=order default="sent" %}</span>
                <i class="dropdown icon"></i>

                <div class="menu">
                      <a class="item" href="{% url "inbox" %}{% relative_url 'sent' 'order' params %}">
                          <i class="{% get_icon 'sent' %}"></i>newest to oldest
                      </a>
                      <a class="item" href="{% url "inbox" %}{% relative_url 'rsent' 'order' params %}">
                          <i class="{% get_icon 'rsent' %}"></i>oldest to newst
                      </a>

                      <a class="item" href="{% url "inbox" %}{% relative_url 'rep' 'order' params %}">
                          <i class="{% get_icon 'rep' %}"></i>sender reputation
                      </a>
                </div>
              </div>
            </div>
    </div>
{% endwith %}

    <div class="ui basic no-padding segment">
<div class="ui doubling stackable grid">
    <div class="three wide column">
        <div class="ui basic segment" style="padding-left:5px">
            {% message_menu extra_tab=extra_tab_name request=request %}
        </div>

    </div>

<div class="thirteen wide column">

<div class="ui basic segment" >

<table class="ui table messages">


{% for message in all_messages %}

<tbody class="item {% is_unread tab_name=extra_tab_name message=message%} message">
<tr>
 <td>
        <a class="ui mini avatar image" href="{% url "user_profile" message.sender.profile.uid %}" style="width:25px">
            {% gravatar user=message.sender size=50 %}</a>
        {{message.sender.profile.name}}
 </td>
<td>
        <div class="middle aligned content">
            <div class="ui small messages header">

                Subject:
                {% if extra_tab_name|is_inbox %}
                <a href="{{message.inbox_url}}?active={{extra_tab_name}}">{{message.subject|truncatechars:90}}</a>
                {% else %}
                <a href="{{message.outbox_url}}?active={{extra_tab_name}}">{{message.subject|truncatechars:90}}</a>
                {% endif %}

            </div>



           <div class="ui right floated item" style="float: right;">
           {{message.sent_date|time_ago}}
           </div>

            <div class="ui muted item" style="">
              {{message.body|truncatechars:140}}
          </div>
        </div>

    </td>

        </tr>
    </tbody>

{% endfor %}


</table>

</div>
</div>

</div>
    </div>
    <div class="centered">
    {% pages objs=all_messages request=request %}
</div>
{% endblock %}
